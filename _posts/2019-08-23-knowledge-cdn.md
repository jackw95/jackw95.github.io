---
layout: post
title:  "CDN"
date:   2019-08-23
categories: 知识点
tags: web
excerpt: 知识点
---

* content
{:toc}

#### `CDN`

`Content Delivery Network`：内容分发网络


**基本原理**  
   _广泛采用各种缓存服务器，将这些缓存服务器分布到用户访问相对集中的地区或网络中，在用户访问网站时，利用全局负载技术将用户的访问指向距离最近的工作正常的缓存服务器上，由缓存服务器直接响应用户请求_


**构成**  
1、内容缓存设备：为`CDN`网络节点，是面向最终用户的内容提供设备，可缓存静态`Web`内容和流媒体内容，以便用户的就近访问。  
2、内容交换机：处于用户接入集中点，可以均衡单点多个内容缓存设备的负载，并对内容进行缓存负载平衡及访问控制。  
3、内容路由器：负责将用户的请求调度到适当的设备上。  
4、内容管理系统：负责整个`CDN`的管理，作用是进行内容管理，如内容的注入和发布、内容的分发、内容的审核、内容的服务等


**正常一次网络请求**
- 在浏览器输入要访问的网站域名
- 浏览器向本地`DNS`服务器请求对该域名的解析
- 本地`DNS`服务器中如果缓存有这个域名的解析结果，则直接响应用于的解析请求
- 本地`DNS`服务器中如果没有缓存这个域名的解析结果，则以迭代方式向整个`DNS`系统请求解析，获取应答后将结果反馈给浏览器
- 浏览器得到域名解析结果，就是该域名对应的服务设备的IP地址
- 浏览器获取`IP`地址后，经过标准的`TCP`三次握手，建立`TCP`连接
- 浏览器向服务器发起`HTTP`请求
- 服务器将用户请求内容响应到浏览器
- 经过标准的`TCP`挥手流程，断开`TCP`连接

使用`CDN`后：
- 如果本地`DNS`服务器没有对应域名的缓存，则本地DNS系统会将域名的解析权交给`CNAME`指向的`CDN`专用`DNS`服务器
- `CDN`的`DNS`服务器将`CDN`的全局负载均衡设备`IP`地址返回给用户
- 用户向`CDN`的全局负载均衡设备发起URL请求
- `CDN`全局负载均衡设备根据用户IP地址，以及用户请求的`URL`，选择一台用户所属区域的负载均衡设备，请将请求转发到此负载均衡设备上。
- 区域负载均衡设备会选择一个最优的缓存服务器节点，并从缓存服务器节点得到服务器的`IP`地址，最终将得到的IP地址返回给全局负载均衡设备；
- 根据用户的`IP`地址和`URL`请求的内容，全局负载均衡设备判断哪一个边缘节点离用户最近且有所需要的内容，并将该缓存服务器`IP`地址返回给用户
- 用户向缓存服务器发起请求

